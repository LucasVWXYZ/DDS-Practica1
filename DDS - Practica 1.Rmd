---
title: "DDS - Práctica 1"
output: html_document
date: "2024-01-09"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Data Driven Security - Actividad Evaluable 1

## Víctor López García & Lucas Carrillo Mas

### 2. Introducción a R

```{r carga paquetes}
library(tidyverse)
library(readr)
library(stringr)
library(tidyr)
```

```{r carga datos}
Logs_http <- read_delim("epa-http.csv", delim = " ", show_col_types = FALSE)
```

```{r limpieza datos}
colnames(Logs_http) <- c("source", "timestamp", "petition", "status", "bytes")
Logs_http <- separate(Logs_http, petition, into = c("type", "url", "protocol"), sep = " ")
Logs_http <- Logs_http %>%
  mutate(
    # source se mantiene como caracteres
    timestamp = strptime(timestamp, format = "[%d:%H:%M:%s]"),  # Cambiar la columna timestamp a fecha
    type = as.factor(type),  # Cambiar la columna type a factor
    # url se mantiene como caracteres
    # protocol se mantiene como caracteres
    status = as.factor(status),  # Cambiar la columna status a factor
    bytes = as.integer(bytes)  # Cambiar la columna port a entero
  )

head(Logs_http)
```

```{r visualización dataframe}
View(Logs_http)
```

Empezamos con los ejercicios de la práctica, que listaremos a continuación junto con su resolución en formato código.

#### Pregunta 1

1.  Cuales son las dimensiones del dataset cargado (número de filas y columnas)

```{r análisis preliminar}
dimensiones_dataframe <- dim(Logs_http)
print(dimensiones_dataframe)
```

Lo que nos dice que el dataframe tiene 47747 filas y 7 columnas (después de separar la columna "petition" en 3).

2.  Valor medio de la columna Bytes

```{r análisis preliminar}
media_bytes <- mean(Logs_http$bytes, na.rm=TRUE)
print(media_bytes)
```

#### Pregunta 2

De las diferentes IPs de origen accediendo al servidor, ¿cuantas pertenecen a una IP claramente educativa (que contenga ".edu")?

```{r IP edu}
numIP_edu <- sum(grepl(".edu", Logs_http$source))
numIPunicas_edu <- sum(grepl(".edu", unique(Logs_http$source)))
print(numIP_edu)
print(numIPunicas_edu)
```

Vemos que hay 6539 logs en los que IPs educativas acceden al servidor, pero de ellas, solamente 376 IPs son únicas.

#### Pregunta 3

De todas las peticiones recibidas por el servidor cual es la hora en la que hay mayor volumen de peticiones HTTP de tipo "GET"?

#### Pregunta 4

De las peticiones hechas por instituciones educativas (.edu), ¿Cuantos bytes en total se han transmitido, en peticiones de descarga de ficheros de texto ".txt"?

```{r bytes edu txt}
IPedu <- grepl(".edu", Logs_http$source)
IPtxt <- grepl(".txt", Logs_http$url)
IP_tot <- IPedu & IPtxt
sum_bytes <- sum(Logs_http[IP_tot,"bytes"], na.rm = TRUE)
print(sum_bytes)

#numIP_edu <- sum(grepl(".edu", Logs_http$source))
#numIPunicas_edu <- sum(grepl(".edu", unique(Logs_http$source)))
#print(numIP_edu)
#print(numIPunicas_edu)
```

Vemos que el tamaño total de bytes para peticiones de IPs educativas de descarga de ficheros de texto ".txt" es 3017871 bytes. Notar que como en la columna "bytes" había valores no disponibles (NA), hemos tenido que eliminarlos para esta suma.

#### Pregunta 5

Si separamos la petición en 3 partes (Tipo, URL, Protocolo), usando str_split y el separador " " (espacio), ¿cuantas peticiones buscan directamente la URL = "/"?

```{r busqueda a raiz (/)}
num_raiz <- sum(Logs_http$url == "/")

print(num_raiz)
```
El total de peticiones a la raiz del dominio es 2382.


#### Pregunta 6

Aprovechando que hemos separado la petición en 3 partes (Tipo, URL, Protocolo) ¿Cuantas peticiones NO tienen como protocolo "HTTP/0.2"?

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
